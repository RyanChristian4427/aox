SubDir TOP aox ;
SubInclude TOP encodings ;
SubInclude TOP message ;
SubInclude TOP server ;

rule BuildInfo {
    Depends $(<) : $(>) ;
    Clean clean : $(<) ;
    SEARCH on $(>) = $(TOP) ;
    MakeLocate $(<) : $(LOCATE_SOURCE) ;
}

actions BuildInfo {
    cat $(>) | \
    sed -e 's/#.*//' -e 's/[\\"]/\\&/g'| \
    grep . | \
    sed -e 's/\(.*\)/"\1",/' > $(<)
}

BuildInfo buildinfo.inc : buildinfo [ Glob $(TOP) : buildinfo.* ] ;

Build aox :
    aox.cpp aoxcommand.cpp aliases.cpp servers.cpp db.cpp reparse.cpp
    anonymise.cpp mailboxes.cpp users.cpp stats.cpp updatedb.cpp ;

Program aox :
    aox database schema server mailbox message user core
    encodings extractors ;
